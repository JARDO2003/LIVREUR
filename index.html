<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eden Taxi Moto</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-database-compat.min.js"></script>
    <!-- Ajout des ressources Leaflet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
            background-image: url('image/taxi moto.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }
        
        .header {
            background-color: #222;
            color: white;
            padding: 12px 0;
            text-align: center;
            position: relative;
        }
        
        .nav-menu {
            display: flex;
            justify-content: center;
            background-color: #333;
            padding: 10px 0;
        }
        
        .nav-button {
            background-color: #555;
            color: white;
            border: none;
            padding: 8px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .nav-button:hover {
            background-color: #777;
            transform: translateY(-2px);
        }
        
        .container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .section-title {
            color: #0084ff;
            border-bottom: 2px solid #423b3b;
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        /* ChatBot Section */
        .chatbot {
            border: 1px solid #ebe8e8;
            border-radius: 10px;
            padding: 15px;
            height: 400px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0eded;
        }

        .chatbot-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .chatbot-info {
            flex: 1;
        }

        .chatbot-name {
            font-weight: bold;
            margin: 0;
        }

        .chatbot-status {
            color: #28a745;
            font-size: 0.9em;
            margin: 0;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }
        
        .bot-message {
            background-color: #f1f0f0;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .user-message {
            background-color: #0084ff;
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .order-button {
            background-color: #ff6b00;
            padding: 12px 20px;
            font-size: 18px;
            width: 100%;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            animation: orderPulse 2s infinite;
            transition: all 0.3s;
        }
        
        .order-button:hover {
            background-color: #e65c00;
            transform: translateY(-2px);
        }
        
        @keyframes orderPulse {
            0% {
                background-color: #ff6b00;
            }
            50% {
                background-color: #e65c00;
                box-shadow: 0 0 15px rgba(255, 107, 0, 0.5);
            }
            100% {
                background-color: #ff6b00;
            }
        }
        
        /* Services Section */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .service-card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            border: 1px solid #eee;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .service-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: #0084ff;
        }
        
        /* Map Section */
        .map-container {
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .map-placeholder {
            width: 100%;
            height: 100%;
            background-color: #e9e9e9;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            color: #777;
        }
        
        /* Testimonials Section */
        .testimonials {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .testimonial-card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #0084ff;
        }
        
        .testimonial-text {
            font-style: italic;
            margin-bottom: 10px;
        }
        
        .testimonial-author {
            font-weight: bold;
            text-align: right;
        }
        
        /* Registration Form */
        #registration-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: 600;
        }
        
        input[type="text"], 
        input[type="tel"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .form-button:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
        }
        
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close-button:hover {
            color: #000;
        }
        
        /* Footer */
        .footer {
            background-color: #222;
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
        }

        /* AJOUT DES STYLES RESPONSIVE */
        
        /* Pour tablettes */
        @media screen and (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .services-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .testimonials {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 15% auto;
                max-width: 90%;
            }
            
            .chatbot {
                height: 350px;
            }
            
            .map-container {
                height: 350px;
            }
        }
        
        /* Pour mobiles */
        @media screen and (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .nav-menu {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .nav-button {
                width: 80%;
                margin: 0;
            }
            
            .services-grid {
                grid-template-columns: 1fr;
            }
            
            .section {
                padding: 15px;
            }
            
            .chatbot {
                height: 300px;
                padding: 10px;
            }
            
            .chatbot-avatar {
                width: 40px;
                height: 40px;
            }
            
            .order-button {
                font-size: 16px;
                padding: 10px;
            }
            
            .map-container {
                height: 300px;
            }
            
            .modal-content {
                margin: 20% auto;
                padding: 15px;
            }
            
            .service-icon {
                font-size: 30px;
            }
            
            .message {
                max-width: 90%;
                padding: 8px;
            }
        }
        
        /* Pour tr√®s petits √©crans */
        @media screen and (max-width: 320px) {
            .header h1 {
                font-size: 1.2rem;
            }
            
            .section-title {
                font-size: 1.3rem;
            }
            
            .chatbot {
                height: 250px;
            }
            
            .chat-messages {
                padding: 5px;
            }
            
            .map-container {
                height: 250px;
            }
            
            .order-button {
                font-size: 14px;
                padding: 8px;
            }
            
            .form-button {
                padding: 10px;
            }
            
            input[type="text"], 
            input[type="tel"] {
                padding: 8px;
                font-size: 14px;
            }
        }
        
        /* Pour les √©crans √† orientation paysage sur mobile */
        @media screen and (max-height: 480px) and (orientation: landscape) {
            .chatbot {
                height: 200px;
            }
            
            .map-container {
                height: 200px;
            }
            
            .modal-content {
                margin: 5% auto;
            }
        }

        /* Pour les √©crans de grande taille */
        @media screen and (min-width: 1200px) {
            .container {
                max-width: 1200px;
            }
            
            .services-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .testimonials {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>Eden Taxi Moto</h1>
    </div>
    
    <!-- Navigation Menu -->
    <div class="nav-menu">
        <button class="nav-button" onclick="showSection('home')">Accueil</button>
        <button class="nav-button" onclick="showModal('about-modal')">√Ä propos</button>
        <button class="nav-button" onclick="showModal('contact-modal')">Contact</button>
    </div>
    
    <div class="container">
        <!-- Registration Section -->
        <div class="section" id="registration-section">
            <h2 class="section-title">Inscription</h2>
            <form id="registration-form">
                <div class="form-group">
                    <label for="user-name">Nom</label>
                    <input type="text" id="user-name" placeholder="Votre nom" required>
                </div>
                
                <div class="form-group">
                    <label for="user-firstname">Pr√©nom</label>
                    <input type="text" id="user-firstname" placeholder="Votre pr√©nom" required>
                </div>
                
                <div class="form-group">
                    <label for="user-phone">Num√©ro de t√©l√©phone</label>
                    <input type="tel" id="user-phone" placeholder="Votre num√©ro de t√©l√©phone" required>
                </div>
                
                <div class="form-group">
                    <button type="button" id="location-button" class="form-button">Activer la localisation</button>
                    <span id="location-status">Localisation: Non activ√©e</span>
                </div>
                
                <button type="button" id="register-button" class="form-button" disabled>S'inscrire</button>
            </form>
        </div>
        
        <!-- ChatBot Section -->
        <div class="section" id="chatbot-section" style="display: none;">
            <h2 class="section-title">Commander un Taxi</h2>
            <div class="chatbot">
                <div class="chat-header">
                    <img src="image/robot.jpg" alt="Eden Assistant" class="chatbot-avatar">
                    <div class="chatbot-info">
                        <p class="chatbot-name">Eden Assistant</p>
                        <p class="chatbot-status">En ligne</p>
                    </div>
                </div>
                <div class="chat-messages" id="chat-messages-client">
                    <!-- Messages will be added here dynamically -->
                </div>
                <div style="margin-top: 15px;">
                    <button class="order-button" id="order-taxi-button">Commander un taxi maintenant</button>
                </div>
            </div>
        </div>
        
        <!-- Services Section -->
        <div class="section">
            <h2 class="section-title">Autres Services</h2>
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-icon">üè¢</div>
                    <h3>Transport vers A√©roport</h3>
                    <p>Service rapide et ponctuel vers tous les a√©roports</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">üì¶</div>
                    <h3>Livraison Express</h3>
                    <p>Livraison de colis dans toute la ville</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">üöñ</div>
                    <h3>R√©servation √† l'avance</h3>
                    <p>Planifiez vos trajets importants</p>
                </div>
            </div>
        </div>
        
        <!-- Map Section -->
        <div class="section">
            <h2 class="section-title">Carte de la Ville</h2>
            <div class="map-container">
                <div id="map">
                    <div class="map-placeholder">
                        Carte de la ville - Chargement...
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Testimonials Section -->
        <div class="section">
            <h2 class="section-title">Avis Clients</h2>
            <div class="testimonials">
                <div class="testimonial-card">
                    <p class="testimonial-text">"Service rapide et professionnel. Le chauffeur est arriv√© √† l'heure et m'a conduit en toute s√©curit√© √† ma destination."</p>
                    <p class="testimonial-author">- Marie L.</p>
                </div>
                <div class="testimonial-card">
                    <p class="testimonial-text">"Application facile √† utiliser. J'ai command√© un taxi et en moins de 5 minutes, il √©tait √† ma porte. Impressionnant !"</p>
                    <p class="testimonial-author">- Thomas B.</p>
                </div>
                <div class="testimonial-card">
                    <p class="testimonial-text">"Excellent service pour √©viter les embouteillages. Le chauffeur connaissait des raccourcis efficaces."</p>
                    <p class="testimonial-author">- Sophia M.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal About -->
    <div id="about-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('about-modal')">&times;</span>
            <h2>√Ä propos d'Eden Taxi Moto</h2>
            <p>Eden Taxi Moto est un service de transport √† moto professionnel op√©rant dans toute la ville. Notre flotte de motos et nos chauffeurs exp√©riment√©s vous garantissent un service rapide, s√©curis√© et fiable.</p>
            <p>Nous proposons des services de transport de personnes, de livraison de colis et de transport vers les a√©roports.</p>
        </div>
    </div>
    
    <!-- Modal Contact -->
    <div id="contact-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('contact-modal')">&times;</span>
            <h2>Contactez-nous</h2>
            <p><strong>T√©l√©phone:</strong> 0172369840</p>
            <p><strong>Email:</strong> zinzindohouemarcio@gmail.com</p>
            <p><strong>Adresse:</strong> 123 Avenue des TRAORE</p>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        <p>&copy; 2025 Eden Taxi Moto. Tous droits r√©serv√©s.</p>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBSPNvZqwX31r2b9GqyyxTmfjXGpNmAvzI",
            authDomain: "marcius-82e4c.firebaseapp.com",
            databaseURL: "https://marcius-82e4c-default-rtdb.firebaseio.com",
            projectId: "marcius-82e4c",
            storageBucket: "marcius-82e4c.firebasestorage.app",
            messagingSenderId: "345743987757",
            appId: "1:345743987757:web:cb6941f795ff99ad8e54a4",
            measurementId: "G-K6S4BKPR10"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // User data
        let userData = {
            name: '',
            firstname: '',
            phone: '',
            location: null
        };

        // DOM elements
        const registrationSection = document.getElementById('registration-section');
        const chatbotSection = document.getElementById('chatbot-section');
        const chatMessagesClient = document.getElementById('chat-messages-client');
        const registerButton = document.getElementById('register-button');
        const locationButton = document.getElementById('location-button');
        const locationStatus = document.getElementById('location-status');
        const orderTaxiButton = document.getElementById('order-taxi-button');
        const mapElement = document.getElementById('map');
        
        // Variables pour la carte
        let map = null;
        let userMarker = null;
        
        // Event listeners
        locationButton.addEventListener('click', getLocation);
        registerButton.addEventListener('click', handleRegistration);
        orderTaxiButton.addEventListener('click', orderTaxi);
        
        // Initialiser la carte avec un placeholder
        initMapPlaceholder();
        
        function initMapPlaceholder() {
            mapElement.innerHTML = `
                <div class="map-placeholder">
                    <div style="text-align: center;">
                        <div style="font-size: 50px; margin-bottom: 20px;">üó∫Ô∏è</div>
                        <p>Activez la localisation pour afficher la carte</p>
                    </div>
                </div>
            `;
        }
        
        // Initialiser la carte avec Leaflet
        function initMap(latitude, longitude) {
            // Effacer le contenu actuel
            mapElement.innerHTML = '';
            
            // Cr√©er la carte centr√©e sur la position de l'utilisateur
            map = L.map('map').setView([latitude, longitude], 14);
            
            // Ajouter une couche de carte (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Ajouter un marqueur pour la position de l'utilisateur
            userMarker = L.marker([latitude, longitude]).addTo(map)
                .bindPopup('Votre position actuelle')
                .openPopup();
            
            // Ajouter quelques marqueurs fictifs pour les taxis disponibles dans un rayon de 2km
            addFakeTaxiMarkers(latitude, longitude, 5);
            
            // Ajouter un cercle pour repr√©senter la zone de service
            L.circle([latitude, longitude], {
                color: '#0084ff',
                fillColor: '#0084ff',
                fillOpacity: 0.1,
                radius: 3000 // rayon en m√®tres (3km)
            }).addTo(map);
        }
        
        function addFakeTaxiMarkers(lat, lng, count) {
            // Ic√¥ne personnalis√©e pour les taxis
            const taxiIcon = L.divIcon({
                html: 'üèçÔ∏è',
                className: 'taxi-icon',
                iconSize: [30, 30]
            });
            
            // Ajouter des marqueurs fictifs pour les motos-taxis disponibles
            for (let i = 0; i < count; i++) {
                // G√©n√©rer des positions al√©atoires dans un rayon de 2km
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 0.02; // ~2km en degr√©s approximativement
                const newLat = lat + distance * Math.cos(angle);
                const newLng = lng + distance * Math.sin(angle);
                
                L.marker([newLat, newLng], {icon: taxiIcon}).addTo(map)
                    .bindPopup('Moto-taxi disponible');
            }
        }
        
        function getLocation() {
            if (navigator.geolocation) {
                locationStatus.textContent = "Localisation: En cours...";
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userData.location = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            timestamp: new Date().getTime()
                        };
                        locationStatus.textContent = "Localisation: Activ√©e ‚úì";
                        locationStatus.style.color = "green";
                        locationButton.textContent = "Localisation activ√©e ‚úì";
                        locationButton.style.backgroundColor = "#28a745";
                        
                        // Initialiser la carte avec la position r√©elle
                        initMap(position.coords.latitude, position.coords.longitude);
                        
                        checkFormCompletion();
                    },
                    (error) => {
                        locationStatus.textContent = "Localisation: Erreur";
                        locationStatus.style.color = "red";
                        alert("Erreur de g√©olocalisation: " + error.message);
                    }
                );
            } else {
                locationStatus.textContent = "Localisation: Non support√©e par votre navigateur";
                locationStatus.style.color = "red";
                alert("La g√©olocalisation n'est pas prise en charge par ce navigateur.");
            }
        }
        
        function checkFormCompletion() {
            const nameInput = document.getElementById('user-name');
            const firstnameInput = document.getElementById('user-firstname');
            const phoneInput = document.getElementById('user-phone');
            
            if (nameInput.value && firstnameInput.value && phoneInput.value && userData.location) {
                registerButton.disabled = false;
            } else {
                registerButton.disabled = true;
            }
        }
        
        // Ajout d'√©couteurs d'√©v√©nements pour les champs input
        document.getElementById('user-name').addEventListener('input', checkFormCompletion);
        document.getElementById('user-firstname').addEventListener('input', checkFormCompletion);
        document.getElementById('user-phone').addEventListener('input', checkFormCompletion);
        
        function handleRegistration() {
            // R√©cup√©rer les valeurs du formulaire
            userData.name = document.getElementById('user-name').value;
            userData.firstname = document.getElementById('user-firstname').value;
            userData.phone = document.getElementById('user-phone').value;
            
            // Sauvegarder l'utilisateur dans Firebase
            const userId = 'user_' + new Date().getTime();
            database.ref('users/' + userId).set({
                name: userData.name,
                firstname: userData.firstname,
                phone: userData.phone,
                location: userData.location,
                registeredAt: firebase.database.ServerValue.TIMESTAMP
            });
            
            // Masquer le formulaire d'inscription et afficher le chatbot
            registrationSection.style.display = 'none';
            chatbotSection.style.display = 'block';
            
            // Initialiser le chatbot
            initChatbot();
        }
        
        function initChatbot() {
            addBotMessage(`üëã Bonjour ${userData.firstname} ! Bienvenue sur Eden Taxi Moto.`);
            addBotMessage("Pour commander un taxi, cliquez sur le bouton ci-dessous.");
        }
        
        function orderTaxi() {
            // G√©n√©rer un ID unique pour la requ√™te
            const requestId = 'request_' + new Date().getTime();
            
            // Sauvegarder la demande dans Firebase
            database.ref('requests/' + requestId).set({
                name: userData.name,
                firstname: userData.firstname,
                phone: userData.phone,
                location: userData.location,
                status: 'pending',
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            
            addUserMessage("Je souhaite commander un taxi maintenant");
            addBotMessage("‚úÖ Votre demande a √©t√© enregistr√©e ! Un chauffeur vous contactera tr√®s prochainement au " + userData.phone + ".");
            
            // Ajouter une animation sur la carte pour montrer que la recherche est en cours
            if (map && userMarker) {
                // Faire pulser le marqueur de l'utilisateur
                userMarker.bindPopup('Recherche de taxi en cours...').openPopup();
                
                // Simuler l'arriv√©e d'un taxi (pour d√©monstration)
                setTimeout(() => {
                    // Cr√©er un marqueur qui se d√©place vers l'utilisateur
                    const lat = userData.location.latitude;
                    const lng = userData.location.longitude;
                    const startLat = lat + 0.01;
                    const startLng = lng + 0.01;
                    
                    const taxiIcon = L.divIcon({
                        html: 'üèçÔ∏è',
                        className: 'assigned-taxi',
                        iconSize: [40, 40]
                    });
                    
                    const movingTaxi = L.marker([startLat, startLng], {icon: taxiIcon}).addTo(map)
                        .bindPopup('Votre taxi arrive !');
                        
                    // Mise √† jour du statut dans Firebase
                    database.ref('requests/' + requestId).update({
                        status: 'accepted',
                        estimatedTime: '5'
                    });
                }, 5000);
            }
            
            // D√©sactiver temporairement le bouton pour √©viter les commandes multiples
            orderTaxiButton.disabled = true;
            orderTaxiButton.textContent = "Demande en cours...";
            
            // R√©activer le bouton apr√®s 30 secondes
            setTimeout(() => {
                orderTaxiButton.disabled = false;
                orderTaxiButton.textContent = "Commander un taxi";
            }, 30000);
            
            // √âcouter les mises √† jour
            database.ref('requests/' + requestId).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data && data.status === 'accepted') {
                    addBotMessage("üèçÔ∏è Bonne nouvelle ! Un chauffeur a accept√© votre course et sera chez vous dans environ " + data.estimatedTime + " minutes.");
                }
            });
        }
        
        function addBotMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot-message';
            messageDiv.textContent = message;
            chatMessagesClient.appendChild(messageDiv);
            chatMessagesClient.scrollTop = chatMessagesClient.scrollHeight;
        }
        
        function addUserMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user-message';
            messageDiv.textContent = message;
            chatMessagesClient.appendChild(messageDiv);
            chatMessagesClient.scrollTop = chatMessagesClient.scrollHeight;
        }
        
        function showSection(sectionId) {
            if (sectionId === 'home') {
                window.location.href = 'eden.html';
            }
        }
        
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        // V√©rifier si l'utilisateur est d√©j√† inscrit au chargement de la page
window.addEventListener('DOMContentLoaded', checkExistingUser);

function checkExistingUser() {
    // R√©cup√©rer les donn√©es utilisateur depuis le localStorage
    const savedUser = localStorage.getItem('edenTaxiUser');
    
    if (savedUser) {
        // Restaurer les donn√©es
        userData = JSON.parse(savedUser);
        
        // Masquer le formulaire d'inscription et afficher le chatbot
        registrationSection.style.display = 'none';
        chatbotSection.style.display = 'block';
        
        // Initialiser le chatbot
        initChatbot();
        
        // Initialiser la carte avec la position sauvegard√©e
        if (userData.location) {
            initMap(userData.location.latitude, userData.location.longitude);
        } else {
            initMapPlaceholder();
        }
    }
}

// Modifier la fonction handleRegistration pour sauvegarder les donn√©es dans localStorage
function handleRegistration() {
    // R√©cup√©rer les valeurs du formulaire
    userData.name = document.getElementById('user-name').value;
    userData.firstname = document.getElementById('user-firstname').value;
    userData.phone = document.getElementById('user-phone').value;
    
    // Sauvegarder l'utilisateur dans Firebase
    const userId = 'user_' + new Date().getTime();
    database.ref('users/' + userId).set({
        name: userData.name,
        firstname: userData.firstname,
        phone: userData.phone,
        location: userData.location,
        registeredAt: firebase.database.ServerValue.TIMESTAMP
    });
    
    // Sauvegarder les donn√©es utilisateur dans localStorage
    localStorage.setItem('edenTaxiUser', JSON.stringify(userData));
    
    // Masquer le formulaire d'inscription et afficher le chatbot
    registrationSection.style.display = 'none';
    chatbotSection.style.display = 'block';
    
    // Initialiser le chatbot
    initChatbot();
}

// Ajouter une fonction pour se d√©connecter (√† utiliser si besoin)
function logout() {
    // Supprimer les donn√©es du localStorage
    localStorage.removeItem('edenTaxiUser');
    
    // R√©initialiser les donn√©es utilisateur
    userData = {
        name: '',
        firstname: '',
        phone: '',
        location: null
    };
    
    // Afficher le formulaire d'inscription et masquer le chatbot
    registrationSection.style.display = 'block';
    chatbotSection.style.display = 'none';
    
    // R√©initialiser la carte
    initMapPlaceholder();
}
        
        // Close modal when clicking outside of it
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>
